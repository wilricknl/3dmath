\documentclass[11pt]{article}

\author{wilricknl}
\title{3D Math Primer - Notes}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{float}
\usepackage{graphicx}
\graphicspath{ {./images/} }
\usepackage{tikz}
\usetikzlibrary{arrows.meta}
\usepackage{url}

\begin{document}

\maketitle

\newpage
\tableofcontents

\newpage
\section{Introduction}

This document is a reference of the things most interesting to me from 3D math primer. This document is by no means a tutorial, so whenever something is unclear: step up your game and figure it out.

\subsection{Conventions}

\begin{itemize}
\item A left handed coordinate space is assumed unless specified otherwise.
\item \textit{Scalar} variables are represented by lowercase Roman or Greek letters in italics: $a$, $b$, $x$, $y$, $z$, $\theta$,
  $\alpha$, $\omega$, $\gamma$.
\item
  \textit{Vector} variables of any dimension are represented by lowercase
  letters in boldface: $\mathbf{a}$, $\mathbf{b}$, $\mathbf{u}$, $\mathbf{v}$, $\mathbf{q}$, $\mathbf{r}$.
\item \textit{Matrix} variables are represented using uppercase letters in
  boldface: $\mathbf{A}$, $\mathbf{B}$, $\mathbf{M}$, $\mathbf{R}$.
\end{itemize}

% Chapter 1 of the book
\newpage
\section{Cartesian Coordinate Systems}

\subsection{Coordinate system handedness}

In 3D space there are two types of coordinate systems: the so-called left and right handed coordinate systems. The way to recreate these systems is to make your index fingers pointer up, then your thumbs should point to each other, while your third finger points away from you. Just like in algebra class your index finger represents the $y$-axis, your thumbs the $x$-axis, while your third finger represents the $z$-axis.

\begin{figure}[H]
\centering
    \begin{tikzpicture}
		\draw [red,-{Stealth}] (-4,0)--(-2,0) node[right] (xleft) {x};        
		\draw [green,-{Stealth}] (-4,0)--(-4,2) node[above]{y};       
		\draw [blue,-{Stealth}] (-4,0)--(-2.5,1) node[above] (zleft) {z};  
		\draw[->] (zleft) to[bend left] node [right] {y} (xleft);
		\node at (-4,-0.5) {Left handed};      
        
		\draw [red,{Stealth}-] (2,0) node[left] (xright) {x} -- (4,0);        
		\draw [green,-{Stealth}] (4,0)--(4,2) node[above]{y};       
		\draw [blue,-{Stealth}] (4,0)--(2.5,1) node[above] (zright) {z};
		\draw[->] (zright) to[bend right] node [left] {y} (xright);  
		\node at (3,-0.5) {Right handed};
		                
    \end{tikzpicture}
\caption{Coordinate system handedness}
\label{fig:coordinate-system-handedness}
\end{figure}

Rotation in a left handed in a left handed system is clock wise, while positive in a right handed system is counter clock wise. In figure  \ref{fig:coordinate-system-handedness} the $y$-rotation of both  coordinate systems is visualized with the black arrow. A trick to remember is to put your thumb up and see how your fingers curl around your palm.

\begin{quote}
\emph{Within these notes I follow the book and use the left handed system as visualized in figure \ref{fig:coordinate-system-handedness}.}
\end{quote}

\subsection{Trigonometry}

\subsubsection{Degrees and radians}

\[
\begin{array}{rll}
{1\ {rad} =} & {\left( 180/\pi \right)^{o}} & {\approx 57.29578^{o},} \\
{1^{o} =} & {\left( \pi/180 \right)\ {rad}} & {\approx 0.01745329\ {rad}.} \\
\end{array}
\]


\subsubsection{Functions}

\begin{align*}
\cos\theta &=x, &\sin\theta &=y, \\
\sec\theta &=\frac{1}{\cos\theta}, &\tan\theta &=\frac{\sin\theta}{\cos\theta}, \\
\csc\theta &=\frac{1}{\sin\theta}, &\cot\theta &=\frac{1}{\tan\theta}=\frac{\cos\theta}{\sin\theta}.
\end{align*}

\subsubsection{SOH CAH TOA}

The primary function are defined by the ratios of a \emph{right} triangle. Note that when the angle is obtuse, i.e. $90^\circ < \theta < 180^\circ$, the ratios do not work.

\begin{figure}[H]
\centering
    \includegraphics{01_sohcahtoa}
\caption{SOH CAH TOA visualisation}
\label{fig:soh-cah-toa-visualization}
\end{figure}

\[\begin{matrix}
{\cos\theta} & {= \frac{\mathit{a}\mathit{d}\mathit{j}}{\mathit{h}\mathit{y}\mathit{p}},} & {\sin\theta} & {= \frac{\mathit{o}\mathit{p}\mathit{p}}{\mathit{h}\mathit{y}\mathit{p}},} & {\tan\theta} & {= \frac{\mathit{o}\mathit{p}\mathit{p}}{\mathit{a}\mathit{d}\mathit{j}},} \\
 & & & & & \\
{\sec\theta} & {= \frac{\mathit{h}\mathit{y}\mathit{p}}{\mathit{a}\mathit{d}\mathit{j}},} & {\csc\theta} & {= \frac{\mathit{h}\mathit{y}\mathit{p}}{\mathit{o}\mathit{p}\mathit{p}},} & {\cot\theta} & {= \frac{\mathit{a}\mathit{d}\mathit{j}}{\mathit{o}\mathit{p}\mathit{p}}.} \\
\end{matrix}\]

The general definitions are defined as follows:
\begin{figure}[H]
\centering
    \includegraphics{01_general_trigonometry_definitions}
\caption{General trigonometry definitions}
\label{fig:general-trigonometry-definitions}
\end{figure}

\[\begin{matrix}
{\cos\theta} & {= x/r,} & {\sin\theta} & {= y/r,} & {\tan\theta} & {= y/x,} \\
 & & & & & \\
{\sec\theta} & {= r/x,} & {\csc\theta} & {= r/y,} & {\cot\theta} & {= x/y.} \\
\end{matrix}\]

\subsubsection{Identities}

\[
\begin{array}{rlrlrl}
{\sin( - \theta) =} & {- \sin\theta,} & {\cos( - \theta) =} & {\cos\theta,} & {\tan( - \theta) =} & {- \tan\theta,} \\
{\sin\left( \frac{\pi}{2} - \theta \right) =} & {\cos\theta,} & {\cos\left( \frac{\pi}{2} - \theta \right) =} & {\sin\theta,} & {\tan\left( \frac{\pi}{2} - \theta \right) =} & {\cot\theta.}
\end{array}
\]

\subsubsection{Common values}

\(\begin{matrix}
{\theta^{o}} & {\theta\ {rad}} & {\cos\theta} & {\sin\theta} & {\tan\theta} & {\sec\theta} & {\csc\theta} & {\cot\theta} \\
0 & 0 & 1 & 0 & 0 & 1 & {undef} & {undef} \\
30 & {\frac{\pi}{6} \approx 0.5236} & \frac{\sqrt{3}}{2} & \frac{1}{2} & \frac{\sqrt{3}}{3} & \frac{2\sqrt{3}}{3} & 2 & \sqrt{3} \\
45 & {\frac{\pi}{4} \approx 0.7854} & \frac{\sqrt{2}}{2} & \frac{\sqrt{2}}{2} & 1 & \sqrt{2} & \sqrt{2} & 1 \\
60 & {\frac{\pi}{3} \approx 1.0472} & \frac{1}{2} & \frac{\sqrt{3}}{2} & \sqrt{3} & 2 & \frac{2\sqrt{3}}{3} & \frac{\sqrt{3}}{3} \\
90 & {\frac{\pi}{2} \approx 1.5708} & 0 & 1 & {undef} & {undef} & 1 & 0 \\
120 & {\frac{2\pi}{3} \approx 2.0944} & {- \frac{1}{2}} & \frac{\sqrt{3}}{2} & {- \sqrt{3}} & {- 2} & \frac{2\sqrt{3}}{3} & {- \frac{\sqrt{3}}{3}} \\
135 & {\frac{3\pi}{4} \approx 2.3562} & {- \frac{\sqrt{2}}{2}} & \frac{\sqrt{2}}{2} & {- 1} & {- \sqrt{2}} & \sqrt{2} & {- 1} \\
150 & {\frac{5\pi}{6} \approx 2.6180} & {- \frac{\sqrt{3}}{2}} & \frac{1}{2} & {- \frac{\sqrt{3}}{3}} & {- \frac{2\sqrt{3}}{3}} & 2 & {- \sqrt{3}} \\
180 & {\pi \approx 3.1416} & {- 1} & 0 & 0 & {- 1} & {undef} & {undef} \\
210 & {\frac{7\pi}{6} \approx 3.6652} & {- \frac{\sqrt{3}}{2}} & {- \frac{1}{2}} & \frac{\sqrt{3}}{3} & {- \frac{2\sqrt{3}}{3}} & {- 2} & {- \sqrt{3}} \\
225 & {\frac{5\pi}{4} \approx 3.9270} & {- \frac{\sqrt{2}}{2}} & {- \frac{\sqrt{2}}{2}} & 1 & {- \sqrt{2}} & {- \sqrt{2}} & {- 1} \\
240 & {\frac{4\pi}{3} \approx 4.1888} & {- \frac{1}{2}} & {- \frac{\sqrt{3}}{2}} & \sqrt{3} & {- 2} & {- \frac{2\sqrt{3}}{3}} & {- \frac{\sqrt{3}}{3}} \\
270 & {\frac{3\pi}{2} \approx 4.7124} & 0 & {- 1} & {undef} & {undef} & {- 1} & 0 \\
300 & {\frac{5\pi}{3} \approx 5.2360} & \frac{1}{2} & {- \frac{\sqrt{3}}{2}} & {- \sqrt{3}} & 2 & {- \frac{2\sqrt{3}}{3}} & {- \frac{\sqrt{3}}{3}} \\
315 & {\frac{7\pi}{4} \approx 5.4978} & \frac{\sqrt{2}}{2} & {- \frac{\sqrt{2}}{2}} & {- 1} & \sqrt{2} & {- \sqrt{2}} & {- 1} \\
330 & {\frac{11\pi}{6} \approx 5.7596} & \frac{\sqrt{3}}{2} & {- \frac{1}{2}} & {- \frac{\sqrt{3}}{3}} & \frac{2\sqrt{3}}{3} & {- 2} & {- \sqrt{3}} \\
360 & {2\pi \approx 6.2832} & 1 & 0 & 0 & 1 & {undef} & {undef} \\
\end{matrix}\)

\subsubsection{Sum and difference identities}

\[\begin{matrix}
{\sin(a + b)} & {= \sin a\cos b + \cos a\sin b,} \\
{\sin(a - b)} & {= \sin a\cos b - \cos a\sin b,} \\
{\cos(a + b)} & {= \cos a\cos b - \sin a\sin b,} \\
{\cos(a - b)} & {= \cos a\cos b + \sin a\sin b,} \\
{\tan(a + b)} & {= \frac{\tan a + \tan b}{1 - \tan a\tan b},} \\
{\tan(a - b)} & {= \frac{\tan a - \tan b}{1 + \tan a\tan b}.} \\
\end{matrix}\]

\subsubsection{Pythagorean identities}

\[\begin{matrix}
{\sin^{2}\theta + \cos^{2}\theta} & {= 1,} & {1 + \tan^{2}\theta} & {= \sec^{2}\theta,} & {1 + \cot^{2}\theta} & {= \csc^{2}\theta.} \\
\end{matrix}\]

\subsubsection{Double angle identities}

\[\begin{matrix}
{\sin 2\theta} & {= 2\sin\theta\cos\theta,} \\
{\cos 2\theta} & {= \cos^{2}\theta - \sin^{2}\theta = 2\cos^{2}\theta - 1 = 1 - 2\sin^{2}\theta,} \\
{\tan 2\theta} & {= \frac{2\tan\theta}{1 - \tan^{2}\theta}.} \\
\end{matrix}\]

\subsubsection{Law of sines and cosines}

\begin{figure}[H]
\centering
    \includegraphics{01_laws}
\caption{Laws of sines and cosines}
\label{fig:laws-of-sines-and-cosines}
\end{figure}

$$\frac{\sin A}{a}=\frac{\sin B}{b}=\frac{\sin C}{c}$$

\begin{align*}
a^2 &= b^2 + c^2 - 2bc\cos A, \\
b^2 &= a^2 + c^2 - 2ac\cos B, \\
c^2 &= a^2 + b^2 - 2ab\cos C.
\end{align*}

% Chapter 2 of the book
\newpage
\section{Vectors}

Vectors are basically an array of numbers which can be used to do cool calculations. We differentiate between two types of vectors: \textit{row} and \textit{column} vectors. The difference between them becomes especially important when multiplying matrices with vectors. Row vectors require post-multiplication, while column vectors require pre-multiplication.

$$
\begin{array}{cc}
\textbf{a} = \begin{bmatrix}
1 & 2 & 3
\end{bmatrix},
&
\textbf{b} = \begin{bmatrix}
4 \\ 5 \\ 6
\end{bmatrix}
\end{array}
$$

\subsection{Magnitude}

The \textit{magnitude} describes the length of the vectors. The length may be any non-negative length. The \textit{direction} of a vectors describes which the vector is pointing. The magnitude can be calculated by taking taking the square root of the summation of the squares of all scalars in the vector. A three dimensional example:

$$\|\textbf{v}\|=\sqrt{{v_x}^2+{v_y}^2+{v_z}^2}$$

\subsection{Unit vector}

A unit vector can be calculated by dividing the vector by its magnitude.

$$\hat{\textbf{v}}=\frac{\textbf{v}}{\|\textbf{v}\|}$$

\subsection{Distance between two vectors}

The distance between two vectors can be calculated by subtracting the two vectors from each other, then calculating the magnitude.

$$\|b-a\|=\sqrt{(b_x-a_x)^2+(b_y-a_y)^2+(b_z-a_z)^2}$$

\subsection{Dot product}

The dot product is the first way of multiplying vectors together. The other one being the cross product, which is the topic of the next section. The way the dot product works is rather simple, but it is mostly the interpretation of its power that makes it a bit more difficult to wrap your head around.

$$\textbf{a}\cdot\textbf{b}=a_xb_x+a_yb_y+a_zb_z$$

$$
\begin{bmatrix}
1 \\ 2 \\ 3
\end{bmatrix} \cdot
\begin{bmatrix}
4 \\ 5 \\ 6
\end{bmatrix}=(1)(4)+(2)(5)+(3)(6)=4+10+18=32
$$

It is simply matching the right scalars and adding it all together, but what does this actually mean?

\subsubsection{Parallel and perpendicular vector}

Using the dot product we can project one vector on another vector. Take the dot product $\hat{\textbf{a}}\cdot\textbf{b}$. By taking the dot product we know how much of $\textbf{b}$ goes parallel to $\textbf{a}$, because $\textbf{a}$ is a unit vector. The dot product returns a scalar, so multiplying this scalar by $\hat{\textbf{a}}$ we calculated $\textbf{b}_\|$, that is the part of $\textbf{b}$ parallel to $\textbf{a}$. The part of $\textbf{b}$ perpendicular to $\textbf{a}$ can be calculated by $\textbf{b}-\textbf{b}_\|=\textbf{b}_\perp$. Putting it all together:

$$\textbf{b}_\|=(\hat{\textbf{a}}\cdot\textbf{b})\hat{\textbf{a}}$$
$$\textbf{b}_\perp=\textbf{b}-\textbf{b}_\|=\textbf{b}-(\hat{\textbf{a}}\cdot\textbf{b})\hat{\textbf{a}}$$
$$\textbf{b}=\textbf{b}_\|+\textbf{b}_\perp$$

\begin{figure}[H]
\centering
    \includegraphics{02_vector_projection}
\caption{Vector projection}
\label{fig:vector-projection}
\end{figure}

\subsubsection{Visibility}

Using the sign of the dot product we can determine where two vectors are in relation to each other.

\begin{figure}[H]
\centering
    \includegraphics{02_dot_signs}
\caption{Dot product signs}
\label{fig:dot-product-signs}
\end{figure}

\begin{itemize}
	\item A positive dot product means $\textbf{b}$ is in front of $\textbf{a}$.
	\item A negative dot product means $\textbf{b}$ is behind $\textbf{a}$.
	\item A dot product with value 0 means that $\textbf{b}$ is exactly to the left or right of $\textbf{a}$.
\end{itemize}

Some nice calculations and practice with this concept can be found in exercises 20 and 21 of chapter 2. These exercises take distance and field of view into account.

\subsubsection{Cosine angle between two vectors}

The final interpretation is to calculate the angle between two vectors using the dot product. The first thing to remember is that $\cos\theta=\frac{\text{adjecent}}{\text{hypotenuse}}$. With the dot product we calculate how much one vector projects on to the other, thus calculating the adjacent value and creating a right triangle as shown in the image below. Assuming unit vectors as shown in the image we derive $\cos\theta=\frac{\text{adjecent}}{\text{hypotenuse}}=\frac{\hat{\textbf{a}}\cdot\hat{\textbf{b}}}{1}=\hat{\textbf{a}}\cdot\hat{\textbf{b}}$. The general formula that does not assume unit vectors is therefore:

$$\cos\theta=\frac{\hat{\textbf{a}}\cdot\hat{\textbf{b}}}{\|\textbf{a}\|\|\textbf{b}\|}$$

Then to get the actual angle:

$$\theta=\arccos\left(\frac{\hat{\textbf{a}}\cdot\hat{\textbf{b}}}{\|\textbf{a}\|\|\textbf{b}\|}\right)$$

\begin{figure}[H]
\centering
    \includegraphics{02_dot_angle}
\caption{Dot product angle}
\label{fig:dot-product-angle}
\end{figure}

Now we can put all this angle calculation into perspective. Take a look at the following table which shows exactly why we were able to use the sign of the dot product to determine if if two vectors are visible with respect to each other.

\begin{table}[H]
\centering
\begin{tabular}{|l|l|l|l|l|}
\hline
$\textbf{a}\cdot\textbf{b}$ & $\theta$ & \textbf{Angle is} & $\textbf{a}$ \textbf{and} $\textbf{b}$ \textbf{are}  \\ \hline
$>0$ & $0^\circ \leq \theta < 90^\circ$ & acute & pointing mostly in the same direction. \\ \hline
$0$ & $\theta=90^\circ$ & right & perpendicular \\ \hline
$<0$ & $90^\circ < \theta \leq 180^\circ$ & obtuse & pointing mostly in the same direction \\ \hline
\end{tabular}
\caption{Dot product angles}
\label{tab:dot-product-angles}
\end{table}

\subsubsection{Magnitude}

A nice thing to realize is that taking the dot product of a vector itself results into the square of its magnitude: $\textbf{v}\cdot\textbf{v}=\|\textbf{v}\|^2$, so $\|\textbf{v}\|=\sqrt{\textbf{v}\cdot\textbf{v}}$.

\subsection{Cross product}

The cross product is slightly more difficult to calculate and does not exist for two dimensional vectors. Unlike the dot product the cross product does not return a scalar, but a vector instead. The general formula is:

$$
\textbf{a}\times\textbf{b}=
\begin{bmatrix}
a_x \\ a_y \\ a_z
\end{bmatrix}\times
\begin{bmatrix}
b_x \\ b_y \\ b_z
\end{bmatrix}=
\begin{bmatrix}
a_yb_z - a_zb_y \\ a_zb_x - a_xb_z \\ a_xb_y - a_yb_x
\end{bmatrix}
$$

\subsubsection{Perpendicular vector}

The geometric interpretation of the cross product is to visualize a third vector perpendicular to the vectors which were used to calculate the cross product. This is for example used to calculate surface normals, but more about that later.

\begin{figure}[H]
\centering
    \includegraphics{02_cross_product}
\caption{Cross product}
\label{fig:cross-product}
\end{figure}

\subsubsection{Sine angle between two vectors}

The cross product has a similar usage as the dot product to calculate an angle between two vectors. In this case it is possible to calculate the sine between two vectors as follows: $\sin\theta=\frac{\|\textbf{a}\times\textbf{b}\|}{\|\textbf{a}\|\|\textbf{b}\|}$.


% Chapter 3 of the book
\newpage
\section{Multiple coordinate spaces}

Coordinate spaces are all over the place. In robotics a point cloud is defined in the space of its sensor. To make actual use of this data we transform the point cloud to be in the space of the robot itself. It is a requirement to be able to think in different coordinate spaces in order to do any serious work. Let's quickly take a look at some common coordinate spaces and how to transform between one coordinate space and another.

\subsection{Common coordinate spaces}

\subsubsection{Object space}

The object space describes vertices of some object to a shared origin. When artists create some model, e.g. a tank, they start modelling the various meshes around an origin within a modelling program like Blender. All the vertices of the various meshes of the model are saved to some file which can be loaded by a game engine.

\subsubsection{World space}

Any interesting game consists of various models each described in their own object space. However, to create a nice world every model gets placed at some world coordinate relative from each other. To properly display the created world all coordinates need to be transformed to this shared world.

\subsubsection{Upright space}

Upright space is a step between object and world space. In upright space the rotation of the world space is already applied. To go from upright space to world space only requires some translation. This space is not always used in tutorials or books, but it is a nice step to make it easier to reason about a switch between coordinate spaces.

\subsubsection{Camera space}

Camera space is the object space associated with the viewpoint used for rendering. The camera space determines which parts of the world are visible.

\subsection{Object space to world space}

Let's take a brief look at an example of transforming a simple pyramid from object space to some world space. First, of all let's define the vertices of the pyramid.

\begin{itemize}
	\item Top: $\begin{bmatrix}
		0 & 2 & 0
	\end{bmatrix}^\intercal$
	\item Front left: $\begin{bmatrix}
		-2 & 0 & -2
	\end{bmatrix}^\intercal$
	\item Front right: $\begin{bmatrix}
		2 & 0 & -2
	\end{bmatrix}^\intercal$
	\item Back left: $\begin{bmatrix}
		-2 & 0 & 2
	\end{bmatrix}^\intercal$
	\item Back right: $\begin{bmatrix}
		2 & 0 & 2
	\end{bmatrix}^\intercal$
\end{itemize}

Furthermore, we know that the world position to be $\begin{bmatrix}2 & 0 & 3\end{bmatrix}^\intercal$, the used coordinate system is left handed and the pyramid is rotated $45^\circ$. With this information we can also state the basis vectors relative to the world space.

\begin{itemize}
	\item Position: $\begin{bmatrix}2 & 0 & 3\end{bmatrix}^\intercal$
	\item $\textbf{p}=\begin{bmatrix}0.707 & 0 & 0.707\end{bmatrix}^\intercal$
	\item $\textbf{q}=\begin{bmatrix}0 & 1 & 0\end{bmatrix}^\intercal$
	\item $\textbf{r}=\begin{bmatrix}0.707 & 0 & -0.707\end{bmatrix}^\intercal$
\end{itemize}

$\textbf{p}$, $\textbf{q}$ and $\textbf{r}$ is a common notation to denote the basis vectors. Basis vectors specify how to interpret coordinates within its space. Good basis vector are orthonormal, that is all vectors are perpendicular to each other and of unit length. Read the book for the exact reasons why. Yup, I choose the easy way out. Now onto the fun part: converting object coordinates to world space!

To transform the vertices of the pyramid to world space we need to apply its basis vectors. Basis vector can contain various transformation like scaling, reflection and rotation. More about these in the chapter about matrices. In this case we only store the rotation relative to the world space. Once the basis vectors are applied all vertices are defined in terms of \textit{upright space}. All that is left to do is to translate all vertices by the position the pyramid is assigned within world space. After this final step all vertices are defined in terms of world space. Note that upright space is not necessary to define explicitly, but it makes it easier to reason about the transformation.

\subsubsection{Transforming a single vertex}

As an example let's transform the front left vertex ($\begin{bmatrix}
		-2 & 0 & -2
	\end{bmatrix}^\intercal$) from object space to world space. Thus we need to apply the basis vectors to the vertex:

$$\textbf{u}=-2\begin{bmatrix}0.707 \\ 0 \\ 0.707\end{bmatrix}+0+-2\begin{bmatrix}0.707 \\ 0 \\ -0.707\end{bmatrix}=\begin{bmatrix}-2.828 \\ 0 \\ 0\end{bmatrix}$$

As stated in the previous chapter the dot product is able to determine how much of a vector goes into a specific direction. This is exactly why we apply the basis vectors against the $x$, $y$, and $z$ coordinate. Now that the axes are aligned there is one final step remaining: we have to add the world position the the upright coordinate:

$$\textbf{w}=\begin{bmatrix}-2.828 \\ 0 \\ 0\end{bmatrix}+\begin{bmatrix}2 \\ 0 \\ 3\end{bmatrix}=\begin{bmatrix}-0.828 \\ 0 \\ 3\end{bmatrix}$$

\subsubsection{Transforming the pyramid}

Let's visualize the pyramid transformation to get a better feel for these coordinate spaces. The values for each of the coordinates are specified in table \ref{tab:pyramid-coordinates-transformation}. In figure \ref{fig:pyramid-object-space} we show the pyramid in its own object space. We specified that we want to rotate our pyramid by $45^\circ$, so we expect to see a rotated pyramid in upright space (figure \ref{fig:pyramid-upright-space}). Finally, to go from upright space to world space the rotation should not just, but only a translation should be applied. This is exactly what happens in figure \ref{fig:pyramid-world-space}. So at this point mess around with the formulas a bit. Convert coordinates between the various spaces and try to understand the diagrams.

\begin{table}[H]
\centering
\begin{tabular}{|l|l|l|l|}
\hline
\textbf{Position} & \textbf{Object space} & \textbf{Upright space} & \textbf{World space} \\ \hline
Top & $\begin{bmatrix}0 & 2 & 0\end{bmatrix}^\intercal$ & $\begin{bmatrix}0 & 2 & 0\end{bmatrix}^\intercal$ & $\begin{bmatrix}2 & 2 & 3\end{bmatrix}^\intercal$ \\ \hline
Front left & $\begin{bmatrix}-2 & 0 & -2\end{bmatrix}^\intercal$ & $\begin{bmatrix}-2.828 & 0 & 0\end{bmatrix}^\intercal$ & $\begin{bmatrix}-0.828 & 0 & 3\end{bmatrix}^\intercal$ \\ \hline
Front right & $\begin{bmatrix}2 & 0 & -2\end{bmatrix}^\intercal$ & $\begin{bmatrix}0 & 0 & 2.828\end{bmatrix}^\intercal$ & $\begin{bmatrix}2 & 0 & 5.828\end{bmatrix}^\intercal$ \\ \hline
Back left & $\begin{bmatrix}-2 & 0 & 2\end{bmatrix}^\intercal$ & $\begin{bmatrix}0 & 0 & -2.828\end{bmatrix}^\intercal$ & $\begin{bmatrix}2 & 0 & 0.172\end{bmatrix}^\intercal$ \\ \hline
Back right & $\begin{bmatrix}2 & 0 & 2\end{bmatrix}^\intercal$ & $\begin{bmatrix}2.828 & 0 & 0\end{bmatrix}^\intercal$ & $\begin{bmatrix}4.828 & 0 & 3\end{bmatrix}^\intercal$ \\ \hline
\end{tabular}
\caption{Pyramid coordinates transformation}
\label{tab:pyramid-coordinates-transformation}
\end{table}

\begin{figure}[H]
\centering
    \includegraphics[scale=0.65]{03_object_space}
\caption{Pyramid in object space}
\label{fig:pyramid-object-space}
\end{figure}

\begin{figure}[H]
\centering
    \includegraphics[scale=0.65]{03_upright_space}
\caption{Pyramid in upright space}
\label{fig:pyramid-upright-space}
\end{figure}

\begin{figure}[H]
\centering
    \includegraphics[scale=0.65]{03_world_space}
\caption{Pyramid in world space}
\label{fig:pyramid-world-space}
\end{figure}

\subsubsection{General formulas}

Let $\textbf{v}$ be an arbitrary vertex is object space, $\textbf{u}$ equal to $\textbf{v}$ transformed in upright space and $\textbf{w}$ equal to $\textbf{v}$ transformed in world space. Furthermore, the basis vectors $\textbf{p}$, $\textbf{q}$ and $\textbf{r}$ with world position $\textbf{o}$.

$$\textbf{u}=v_x\textbf{p}+v_y\textbf{q}+v_z\textbf{r}$$

$$\textbf{w}=\textbf{o}+\textbf{u}=\textbf{o}+v_x\textbf{p}+v_y\textbf{q}+v_z\textbf{r}$$

\subsection{Object space to world space}

To go from world space to object space we need to reverse the process described in the previous section. The formulas to achieve this are as follows:

$$\textbf{u}=\textbf{w}-\textbf{o}$$

$$\textbf{v}=\begin{bmatrix}
\textbf{u}\cdot\textbf{p} \\ \textbf{u}\cdot\textbf{q} \\ \textbf{u}\cdot\textbf{r}
\end{bmatrix}$$


% Chapter 5 of the book
\newpage	
\section{Matrices and Linear Transformations}

\subsection{Rotation matrices}

Make stuff spin around!

\subsubsection{Two dimensional}

\begin{figure}[H]
\centering
    \includegraphics{05_2d_rotation}
\caption{2D rotation visualization}
\label{fig:2d-rotation-visualization}
\end{figure}

$$
\begin{matrix}
{\mathbf{R}(\theta) =
\begin{bmatrix}
{\cos\theta} & {\sin\theta} \\
{- \sin\theta} & {\cos\theta} \\
\end{bmatrix}.} \\
\end{matrix}
$$

\subsubsection{Three dimensional}

Rotation around x-axis: \\
$$
\mathbf{R}_{x}(\theta) = 
\mathbf{R}(
\begin{bmatrix}
1 & 0 & 0 
\end{bmatrix},
\theta) =
 \begin{bmatrix}
1 & 0 & 0 \\
0 & {\cos\theta} & {\sin\theta} \\
0 & {- \sin\theta} & {\cos\theta} \\
\end{bmatrix}
$$

Rotation around y-axis: \\
$$
\mathbf{R}_{y}(\theta) = 
\mathbf{R}(
\begin{bmatrix}
0 & 1 & 0 
\end{bmatrix},
\theta) = \begin{bmatrix}
{\cos\theta} & 0 & {- \sin\theta} \\
0 & 1 & 0 \\
{\sin\theta} & 0 & {\cos\theta} \\
\end{bmatrix}
$$

Rotation around z-axis: \\
$$
\mathbf{R}_{z}(\theta) =
\mathbf{R}(
\begin{bmatrix}
0 & 0 & 1
\end{bmatrix},
\theta) =
\begin{bmatrix}
{\cos\theta} & {\sin\theta} & 0 \\
{- \sin\theta} & {\cos\theta} & 0 \\
0 & 0 & 1 \\
\end{bmatrix}
$$

Rotation around arbitrary axis: \\
$$
\mathbf{R}(\hat{\mathbf{n}},\theta) =
\begin{bmatrix}
{{n_{x}}^{2}\left( 1 - \cos\theta \right) + \cos\theta} & {n_{x}n_{y}\left( 1 - \cos\theta \right) + n_{z}\sin\theta} & {n_{x}n_{z}\left( 1 - \cos\theta \right) - n_{y}\sin\theta} \\
{n_{x}n_{y}\left( 1 - \cos\theta \right) - n_{z}\sin\theta} & {{n_{y}}^{2}\left( 1 - \cos\theta \right) + \cos\theta} & {n_{y}n_{z}\left( 1 - \cos\theta \right) + n_{x}\sin\theta} \\
{n_{x}n_{z}\left( 1 - \cos\theta \right) + n_{y}\sin\theta} & {n_{y}n_{z}\left( 1 - \cos\theta \right) - n_{x}\sin\theta} & {{n_{z}}^{2}\left( 1 - \cos\theta \right) + \cos\theta} \\
\end{bmatrix}
$$

Note that the standard matrices for $x$-, $y$- and $z$-axis can be computed by replacing $\hat{\textbf{n}}$ with the corresponding basis vector. See exercise 2.24. Furthermore, check the book if you want to understand how to derrive these rotation matrices.

\subsection{Scaling matrices}

With scaling can make objects bigger or smaller. When all axes are scaled equally we are scaling \textit{uniformly}, otherwise it's called \textit{non-uniform} scaling.

\subsubsection{Two dimensional}

\begin{figure}[H]
\centering
    \includegraphics{05_scaling}
\caption{2D scaling}
\label{fig:2d-scaling}
\end{figure}

Scaling along the cardinal axes: \\
$$
\mathbf{S}(k_{x},k_{y}) =
\begin{bmatrix}
k_{x} & 0 \\
0 & k_{y} \\
\end{bmatrix}
$$

\subsubsection{Three dimensional}

Scaling along the cardinal axes: \\
$$
\mathbf{S}(k_{x},k_{y},k_{z}) = 
\begin{bmatrix}
k_{x} & 0 & 0 \\
0 & k_{y} & 0 \\
0 & 0 & k_{z}
\end{bmatrix}
$$

Scaling along an arbitrary vector: \\
$$
\mathbf{S}(\hat{\mathbf{n}},k) = \begin{bmatrix}
{1 + \left( k - 1 \right){n_{x}}^{2}} & {\left( k - 1 \right)n_{x}n_{y}} & {\left( k - 1 \right)n_{x}n_{z}} \\
{\left( k - 1 \right)n_{x}n_{y}} & {1 + \left( k - 1 \right){n_{y}}^{2}} & {\left( k - 1 \right)n_{y}n_{z}} \\
{\left( k - 1 \right)n_{x}n_{z}} & {\left( k - 1 \right)n_{y}n_{z}} & {1 + \left( k - 1 \right){n_{z}}^{2}} \\
\end{bmatrix}
$$

As an execise try scaling along the $x$-axis with a factor of $5$, that is $\mathbf{S}(
\begin{bmatrix}
1 & 0 & 0
\end{bmatrix},5)$. It will all make sense, or maybe not.

\subsection{Orthographic projection}

\begin{figure}[H]
\centering
    \includegraphics{05_projection}
\caption{2D projection}
\label{fig:2d-projection}
\end{figure}

The term \textit{projection} in general refers to any dimension reducing operation, so essentially we are going to discard some coordinate. This means we can scale some arbitrary vector by a scale of\dots $0$. No new derivations or matrices, simply use $\mathbf{S}(\hat{\mathbf{n}},0)$.

\subsection{Reflection}

\begin{figure}[H]
\centering
    \includegraphics{05_reflection}
\caption{2D reflection}
\label{fig:2d-reflection}
\end{figure}

Reflection is flipping some axis once, that is, multiplying by $-1$. We once again use our scaling matrices, but this time with a value of $-1$. We can apply a reflection to any arbitrary vector as follows: $\mathbf{S}(\hat{\mathbf{n}},-1)$.

\subsection{Shearing}

\begin{figure}[H]
\centering
    \includegraphics{05_shearing}
\caption{2D shearing}
\label{fig:2d-shearing}
\end{figure}

Shearing also known as skewing basically distorts the coordinate space as shown in the picture above. Check the book for the matrices as this transformation is seldom used, but you know, it's good to know it exists.


% Chapter 7 of the book
\newpage
\section{Polar Coordinate System}

As an alternative to the Cartesian coordinate system there exists the polar coordinate system. A (two dimensional) polar coordinate is described by a rotation and a radius. Like the Cartesian coordinate system we need to define a base grid with an origin and orientation, see figure \ref{fig:polar-coordinate-system}.

\begin{figure}[H]
\centering
    \includegraphics{07_polar_coordinate_system}
\caption{Polar coordinate system}
\label{fig:polar-coordinate-system}
\end{figure}

\subsection{Two dimensional polar coordinates}

The steps to take to find a polar coordinate $(r,\theta)$ are as follows: 

\begin{enumerate}
	\item Start at the origin facing the polar axis. Then rotate by the angle $\theta$, where a positive $\theta$ usually means counter clockwise rotation.
	\item Now move forward from the origin by a distance of $r$ units.
\end{enumerate}

\begin{figure}[H]
\centering
    \includegraphics{07_2d_polar_coordinate}
\caption{Locating 2D polar coordinate}
\label{fig:locating-2d-polar-coordinate}
\end{figure}

\subsubsection{Canonical form}

As you might have noticed there exists aliasing of coordinates. For example, adding $2\pi$ to $\theta$ is aliases the original $\theta$. To avoid aliasing issues polar coordinates can be turned into canonical form:

\begin{itemize}
	\item $r \geq 0$, we don't measure distances "backwards".
	\item $-180^\circ < \theta \leq 180^\circ$, the angle is limited to half a revolution.
	\item $r=0 \implies \theta=0$, at the origin, set the angle to $0$.
\end{itemize}

An example C implementation can be found in the \path{code/} subdirectory with filename \path{07_canonical_2d_polar_coordinates.c}.

\subsubsection{Polar coordinate to Cartesian coordinate}

$$
\begin{array}{lr}
x=r\cos\theta; & y=r\sin\theta.
\end{array}
$$

\subsubsection{Cartesian coordinate to Polar coordinate}

$$
\begin{array}{lr}
r=\sqrt{x^2+y^2}; & \theta=\text{atan2}(y,x).
\end{array}
$$

Refer the book for a more depth explanation why we use $\text{atan2}$ rather than $\arctan$. An example C implementation can be found in the \path{code/} subdirectory with filename \path{07_2d_cartesian_to_polar.c}.

\subsubsection{atan2}

$\text{atan2}$ is a useful function to handle edge cases of $\arctan$. The following definition is roughly how it works in most computer languages. The exception being that $\text{atan2}$ is usually not defined for $(0,0)$, but for ease of use we do make this assumption. Furthermore, remember that the argument order is $y$ followed by $x$. Speaking from experience this is an easy mistake to make.

\begin{equation*}
	\text{atan2}(y,x) =
	\begin{cases}
		0, & x=0,y=0, \\
		+90^\circ, & x=0,y>0, \\
		-90^\circ, & x=0,y<0, \\
		\arctan(y/x), & x>0, \\
		\arctan(y/x)+180^\circ, & x<0,y\geq 0 \\
		\arctan(y/x)-180^\circ, & x<0,y<0
	\end{cases}
\end{equation*}

\subsection{Three dimensional polar coordinates}

The concept of polar coordinates can be extended to three dimensions in two distinct ways: cylindrical and spherical coordinates.

\subsection{Cylindrical coordinates}

The first type of the three dimensional polar coordinate is the cylindrical coordinate. The base of the cylinder is defined by a two dimensional polar coordinate, while the third coordinate is an axis like in Cartesian systems.

\begin{figure}[H]
\centering
    \includegraphics{07_cylindrical_coordinates}
\caption{Cylindrical coordinates}
\label{fig:cylindrical-coordinates}
\end{figure}

\subsubsection{Cylindrical coordinate to Cartesian coordinate}

$$
\begin{array}{lcr}
x=r\cos\theta; & y=r\sin\theta; & z=z.
\end{array}
$$

\subsubsection{Cartesian coordinate to Cylindrical coordinate}

$$
\begin{array}{lcr}
r=\sqrt{x^2+y^2}; & \theta=\text{atan2}(y,x); & z=z.
\end{array}
$$

\subsection{Spherical coordinates}

Unlike cylindrical coordinates, spherical coordinates are a bit more complex and require a bit more computation. A spherical coordinate is defined by two angles and a radius.

\begin{figure}[H]
\centering
    \includegraphics{07_spherical_coordinates}
\caption{Spherical coordinates}
\label{fig:spherical-coordinates}
\end{figure}

\subsubsection{Canonical Spherical coordinates}

Spherical coordinates has even more issues with regards to aliasing. So once again we define some common rules to avoid this. Where $\theta$ is replaced with the letter $h$ for heading, and $\phi$ replaced with the letter $p$ for pitch:

\begin{itemize}
	\item $r \geq 0$, we don't measure distances "backwards".
	\item $-180^\circ < h \leq 180^\circ$, the heading is limited to half a revolution.
	\item  $-90^\circ \leq p \leq 90^\circ$, pitch limits are straight up and down.
	\item $r=0 \implies h=p=0$, at the origin set the angles to $0$.
	\item $|p|=90^\circ \implies h=0$, when looking up or down set heading to $0$.
\end{itemize}

An example C implementation can be found in the \path{code/} subdirectory with filename \path{07_canonical_spherical_coordinates.c}.

\subsubsection{Canonical Spherical coordinate to Cartesian coordinate}

$$
\begin{array}{lcr}
x=r\cos p \sin h; & y=-r\sin p; & z=\cos p \cos h.
\end{array}
$$

\subsubsection{Cartesian coordinate to Canonical Spherical coordinate}

$$
\begin{array}{lcr}
r=\sqrt{x^2+y^2+z^2}; & h=\text{atan2}(x,z); & p=\arcsin(-y/r).
\end{array}
$$

An example C implementation can be found in the \path{code/} subdirectory with filename \path{07_3d_cartesian_to_spherical.c}.

\end{document}
